diff -urN a/adler32.c b/adler32.c
--- a/adler32.c	1970-01-01 08:00:00.000000000 +0800
+++ b/adler32.c	2021-11-11 17:08:55.876434484 +0800
@@ -0,0 +1,28 @@
+#include <string.h>
+#include <stdlib.h>
+
+u_int32_t local_adler32(u_int8_t * buffer, int32_t length)
+{
+    int32_t cnt;
+    u_int32_t  result, lowHalf, highHalf;
+
+    lowHalf = 1;
+    highHalf = 0;
+
+    for (cnt = 0; cnt < length; cnt++) {
+        if ((cnt % 5000) == 0) {
+            lowHalf  %= 65521L;
+            highHalf %= 65521L;
+        }
+
+        lowHalf += buffer[cnt];
+        highHalf += lowHalf;
+    }
+
+    lowHalf  %= 65521L;
+    highHalf %= 65521L;
+
+    result = (highHalf << 16) | lowHalf;
+
+    return result;
+}
diff -urN a/kextcache_main.c b/kextcache_main.c
--- a/kextcache_main.c	2019-09-18 03:04:24.000000000 +0800
+++ b/kextcache_main.c	2021-11-11 17:08:00.475338247 +0800
@@ -45,7 +45,6 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <Security/SecKeychainPriv.h>
-#include <sandbox/rootless.h>
 #include <sys/csr.h>
 #include <sys/sysctl.h>
 
diff -urN a/kextload_main.c b/kextload_main.c
--- a/kextload_main.c	2019-05-17 09:48:36.000000000 +0800
+++ b/kextload_main.c	2021-11-11 18:45:55.006214050 +0800
@@ -373,6 +373,7 @@
 
 /*******************************************************************************
 *******************************************************************************/
+#ifndef TARGET_OS_EMBEDDED
 ExitStatus loadKextsViaKextd(KextloadArgs * toolArgs)
 {
     ExitStatus result     = EX_OK;
@@ -453,7 +454,7 @@
 
     return result;
 }
-
+#endif
 /*******************************************************************************
 *******************************************************************************/
 ExitStatus loadKextsIntoKernel(KextloadArgs * toolArgs)
diff -urN a/kext_tools_util.c b/kext_tools_util.c
--- a/kext_tools_util.c	2019-10-09 01:46:10.000000000 +0800
+++ b/kext_tools_util.c	2021-11-11 18:32:35.986313409 +0800
@@ -1,3 +1,4 @@
+#include <os/trace_base.h>
 /*
  * Copyright (c) 2008 Apple Computer, Inc. All rights reserved.
  *
@@ -37,7 +38,6 @@
 #include <sys/resource.h>
 #include <IOKit/kext/OSKext.h>
 #include <IOKit/kext/OSKextPrivate.h>
-#include <sandbox/rootless.h>
 #include <os/log_private.h>
 
 #include <sys/types.h>
diff -urN a/mkext.c b/mkext.c
--- a/mkext.c	2019-03-28 06:30:15.000000000 +0800
+++ b/mkext.c	2021-11-11 18:38:18.882465770 +0800
@@ -25,7 +25,6 @@
 #include <libsa/mkext.h>
 #include <libsa/stdlib.h>
 #else
-#include <Kernel/libsa/mkext.h>
 #include <stdlib.h>
 #endif KERNEL
 
diff -urN a/signposts.h b/signposts.h
--- a/signposts.h	2019-04-13 03:58:31.000000000 +0800
+++ b/signposts.h	2021-11-11 17:11:11.208046087 +0800
@@ -8,7 +8,6 @@
 
 #include <os/log.h>
 #include <os/signpost.h>
-#include <os/signpost_private.h>
 
 // shared events
 #define SIGNPOST_EVENT_BOOTCACHE_UPDATE_REASON  "BootcacheUpdateReason"
